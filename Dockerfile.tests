ARG BUILD_TAG=latest
FROM local/nhais:${BUILD_TAG}
RUN apk add git
RUN pipenv install -d --ignore-pipfile
RUN printf "#!/bin/sh\npipenv run unittests-cov \n pipenv run coverage-report && pipenv run coverage-report-xml \n pipenv run componenttests \n pipenv run inttests" > /usr/src/app/test.sh
RUN chmod +x /usr/src/app/test.sh
ENTRYPOINT ["/usr/src/app/test.sh"]
