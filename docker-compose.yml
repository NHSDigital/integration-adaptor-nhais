version: '3'

services:
  nhais:
    image: local/nhais:${BUILD_TAG}
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:8080"
    environment:
      - NHAIS_OUTBOUND_SERVER_PORT=8080
      - NHAIS_AMQP_RETRY_DELAY=100
      - NHAIS_AMQP_MAX_RETRIES=3
      - NHAIS_AMQP_BROKERS=amqp://activemq:5672
      - NHAIS_MESH_OUTBOUND_QUEUE_NAME=nhais_mesh_outbound
      - NHAIS_MONGO_URI=mongodb://mongodb:27017
  activemq:
    build:
      context: ./activemq
    ports:
      - "8161:8161"
      - "5672:5672"
  mongodb:
    image: mongo
    ports:
      - "27017:27017"
  fake-mesh:
    image: nhsdev/fake-mesh:0.1.6
    ports:
      - "8829:8829"
    volumes:
      - ./fake_mesh_dir:/tmp/fake_mesh_dir