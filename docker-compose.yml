version: '3'

services:
  nhais:
    image: local/nhais:${BUILD_TAG}
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "80:8080"
    environment:
      - NHAIS_OUTBOUND_SERVER_PORT=8080
      - NHAIS_AMQP_RETRY_DELAY=100
      - NHAIS_AMQP_MAX_RETRIES=3
      - NHAIS_AMQP_BROKERS=amqp://activemq:5672
      - NHAIS_MESH_OUTBOUND_QUEUE_NAME=nhais_mesh_outbound
      - NHAIS_MONGO_URI=mongodb://mongodb:27017
  activemq:
    build:
      context: ./activemq
    ports:
      - "8161:8161"
      - "5672:5672"
  # nhais-tests:
  #   image: local/nhais-tests:${BUILD_TAG}
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.tests
  #   environment:
  #     - NHAIS_LOG_LEVEL=NOTSET
  #     - NHAIS_OUTBOUND_QUEUE_BROKERS=amqp://rabbitmq:5672
  #     - NHAIS_OUTBOUND_QUEUE_NAME=nhais_mesh_outbound
  #     - NHAIS_DYNAMODB_ENDPOINT_URL=http://dynamodb:8000
  #     - AWS_ACCESS_KEY_ID=test
  #     - AWS_SECRET_ACCESS_KEY=test
  mongodb:
    image: mongo
    ports:
      - "27017:27017"